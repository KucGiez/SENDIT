<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SendIt - Bezprzewodowe Udostƒôpnianie Plik√≥w</title>
    <style>
        :root {
            --primary-color: #0071e3;
            --secondary-color: #86c0fc;
            --light-bg: #f5f5f7;
            --dark-text: #1d1d1f;
            --light-text: #86868b;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --glass-bg: rgba(255, 255, 255, 0.7);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        body {
            background: linear-gradient(120deg, #f5f5f7, #e5e5e7);
            color: var(--dark-text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        #background-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.4;
        }

        header {
            padding: 2rem;
            text-align: center;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .tagline {
            color: var(--light-text);
            font-size: 1.2rem;
            font-weight: 300;
        }

        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 2rem;
        }

        .devices-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 2rem;
            margin: 2rem 0;
            width: 100%;
            max-width: 1200px;
        }

        .section-title {
            width: 100%;
            max-width: 1200px;
            text-align: left;
            margin-bottom: 1rem;
            color: var(--dark-text);
            font-weight: 600;
            font-size: 1.5rem;
            padding-left: 0.5rem;
        }

        .self-device {
            backdrop-filter: blur(10px);
            background-color: var(--glass-bg);
            border-radius: 1.5rem;
            padding: 2rem;
            width: 300px;
            box-shadow: 0 10px 30px var(--shadow-color);
            text-align: center;
            transform-style: preserve-3d;
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .self-device:hover {
            transform: translateY(-10px) rotateX(5deg);
        }

        .device-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .device-name {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .device-status {
            color: var(--light-text);
            margin-bottom: 1.5rem;
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 2rem;
            padding: 0.8rem 2rem;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 113, 227, 0.3);
        }

        .upload-btn:hover {
            background-color: #0062c9;
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 113, 227, 0.4);
        }

        .other-device {
            backdrop-filter: blur(10px);
            background-color: var(--glass-bg);
            border-radius: 1.5rem;
            padding: 2rem;
            width: 300px;
            box-shadow: 0 10px 30px var(--shadow-color);
            text-align: center;
            transform-style: preserve-3d;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            opacity: 0;
            transform: scale(0.9);
            cursor: pointer;
        }

        .other-device.visible {
            opacity: 1;
            transform: scale(1);
        }

        .other-device:hover {
            transform: translateY(-10px) rotateX(5deg);
        }

        /* Sekcja plik√≥w */
        .received-files-container {
            width: 100%;
            max-width: 1200px;
            margin: 2rem 0;
            display: none;
        }

        .files-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
            justify-content: flex-start;
        }

        .file-item {
            backdrop-filter: blur(10px);
            background-color: var(--glass-bg);
            border-radius: 1.5rem;
            padding: 1.5rem;
            width: 250px;
            box-shadow: 0 10px 30px var(--shadow-color);
            text-align: center;
            transform-style: preserve-3d;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            animation: appear 0.5s ease forwards;
        }

        @keyframes appear {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .file-item:hover {
            transform: translateY(-10px) rotateX(5deg);
        }

        .file-icon {
            font-size: 3rem;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .file-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            word-break: break-word;
            white-space: normal;
        }

        .file-size {
            color: var(--light-text);
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .file-actions {
            display: flex;
            justify-content: center;
        }

        .file-download-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 2rem;
            padding: 0.5rem 1.5rem;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 113, 227, 0.3);
        }

        .file-download-btn:hover {
            background-color: #0062c9;
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 113, 227, 0.4);
        }

        .file-preview {
            max-width: 100%;
            max-height: 120px;
            margin-bottom: 1rem;
            border-radius: 0.5rem;
            object-fit: cover;
        }

        .clear-files-btn {
            background-color: #e53935;
            color: white;
            border: none;
            border-radius: 2rem;
            padding: 0.7rem 1.5rem;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
            align-self: flex-end;
        }

        .clear-files-btn:hover {
            background-color: #c62828;
            transform: scale(1.05);
        }

        .transfer-request-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
            background-color: rgba(0, 0, 0, 0.3);
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .transfer-request-container.active {
            opacity: 1;
            pointer-events: auto;
        }
        
        #transfer-request-sender {
            margin-bottom: 1rem;
            font-weight: 500;
        }
        
        #transfer-request-details {
            margin: 1rem 0;
        }
        
        .transfer-file-list {
            max-height: 150px;
            overflow-y: auto;
            margin: 1rem 0;
            text-align: left;
            padding: 0.5rem;
            border-radius: 0.5rem;
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        .transfer-file-item {
            display: flex;
            justify-content: space-between;
            padding: 0.3rem 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .transfer-file-item:last-child {
            border-bottom: none;
        }
        
        .transfer-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }
        
        .accept-btn {
            background-color: var(--primary-color);
            color: white;
        }
        
        .reject-btn {
            background-color: #e53935;
            color: white;
        }
        
        .transfer-actions button {
            border: none;
            border-radius: 2rem;
            padding: 0.8rem 2rem;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .transfer-actions button:hover {
            transform: scale(1.05);
        }

        .transfer-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
            background-color: rgba(0, 0, 0, 0.3);
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .transfer-container.active {
            opacity: 1;
            pointer-events: auto;
        }

        .transfer-panel {
            backdrop-filter: blur(20px);
            background-color: var(--glass-bg);
            border-radius: 1.5rem;
            padding: 2rem;
            width: 400px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
            transform: translateY(30px);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .transfer-container.active .transfer-panel {
            transform: translateY(0);
        }

        .transfer-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .transfer-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .transfer-progress {
            width: 100%;
            height: 6px;
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
            margin: 1.5rem 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.3s ease;
        }

        .transfer-details {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            font-size: 0.9rem;
            color: var(--light-text);
        }

        .toast-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            z-index: 100;
        }

        .toast {
            backdrop-filter: blur(10px);
            background-color: var(--glass-bg);
            border-radius: 1rem;
            padding: 1rem 1.5rem;
            min-width: 300px;
            box-shadow: 0 10px 30px var(--shadow-color);
            display: flex;
            align-items: center;
            transform: translateX(150%);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-icon {
            font-size: 1.5rem;
            margin-right: 1rem;
            color: var(--primary-color);
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 0.2rem;
        }

        .toast-message {
            font-size: 0.9rem;
            color: var(--light-text);
        }

        footer {
            text-align: center;
            padding: 2rem;
            color: var(--light-text);
            font-size: 0.9rem;
        }
        
        /* Animacja transferu czƒÖstek */
        .particles-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 15;
        }
        
        .particle {
            position: absolute;
            background-color: var(--primary-color);
            border-radius: 50%;
            pointer-events: none;
        }

        @media (max-width: 768px) {
            .devices-container {
                flex-direction: column;
                align-items: center;
            }

            .self-device, .other-device {
                width: 100%;
                max-width: 350px;
            }

            .files-grid {
                justify-content: center;
            }
        }

        /* Animacje */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <canvas id="background-canvas"></canvas>
    <div class="particles-container" id="particles-container"></div>
    
    <header>
        <div class="logo">SendIt</div>
        <div class="tagline">Bezprzewodowe udostƒôpnianie plik√≥w w sieci WiFi</div>
    </header>
    
    <main>
        <h3 class="section-title">Dostƒôpne urzƒÖdzenia</h3>
        <div class="devices-container" id="devices-container">
            <div class="self-device">
                <div class="device-icon">üì±</div>
                <div class="device-name" id="self-device-name">Twoje urzƒÖdzenie</div>
                <div class="device-status" id="connection-status">Inicjalizacja...</div>
                <input type="file" id="file-input" class="file-input" multiple>
                <button class="upload-btn" id="upload-btn">Wybierz pliki</button>
            </div>
        </div>

        <div class="received-files-container" id="received-files-container">
            <h3 class="section-title">Odebrane pliki</h3>
            <div class="files-grid" id="files-grid">
                <!-- Tu pojawiƒÖ siƒô odebrane pliki -->
            </div>
            <button class="clear-files-btn" id="clear-files-btn">Wyczy≈õƒá wszystkie</button>
        </div>
    </main>
    
    <div class="transfer-request-container" id="transfer-request-container">
        <div class="transfer-panel">
            <div class="transfer-icon">üì•</div>
            <div class="transfer-title">PrzychodzƒÖcy transfer plik√≥w</div>
            <div id="transfer-request-sender">Od: Nieznany</div>
            <div id="transfer-request-details">
                <p>Pro≈õba o przes≈Çanie <span id="transfer-file-count">0</span> plik√≥w</p>
                <p>≈ÅƒÖczna wielko≈õƒá: <span id="transfer-total-size">0 B</span></p>
            </div>
            <div class="transfer-file-list" id="transfer-file-list">
                <!-- Lista plik√≥w bƒôdzie wygenerowana dynamicznie -->
            </div>
            <div class="transfer-actions">
                <button id="accept-transfer" class="accept-btn">Akceptuj</button>
                <button id="reject-transfer" class="reject-btn">Odrzuƒá</button>
            </div>
        </div>
    </div>
    
    <div class="transfer-container" id="transfer-container">
        <div class="transfer-panel">
            <div class="transfer-icon" id="transfer-direction-icon">üì§</div>
            <div class="transfer-title" id="transfer-title">Wysy≈Çanie pliku</div>
            <div id="transfer-filename">example.jpg</div>
            <div class="transfer-progress">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            <div class="transfer-details">
                <span id="transfer-percentage">0%</span>
                <span id="transfer-speed">0 MB/s</span>
            </div>
            <div class="transfer-actions">
                <button id="cancel-transfer">Anuluj</button>
            </div>
        </div>
    </div>
    
    <div class="toast-container" id="toast-container">
        <!-- Powiadomienia bƒôdƒÖ dodawane dynamicznie -->
    </div>
    
    <footer>
        <p>SendIt &copy; 2025 - ≈Åatwe udostƒôpnianie plik√≥w</p>
    </footer>

    <!-- Skrypty -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/simple-peer@9.11.1/simplepeer.min.js"></script>
    <script src="/js/webrtc-client.js"></script>
    
    <script>
        // Interaktywne t≈Ço z animacjƒÖ czƒÖsteczek
        (function() {
            const canvas = document.getElementById('background-canvas');
            const ctx = canvas.getContext('2d');
            let width = canvas.width = window.innerWidth;
            let height = canvas.height = window.innerHeight;
            let particles = [];
            let mouseX = width / 2;
            let mouseY = height / 2;
            
            // Ustawienia czƒÖsteczek
            const particleCount = 100;
            const particleBaseRadius = 2;
            const particleVariance = 1;
            const baseSpeed = 0.2;
            const mouseMoveRadius = 150;
            const mouseMoveForce = 0.1;
            
            // ≈öledzenie ruchu myszy
            window.addEventListener('mousemove', (e) => {
                mouseX = e.clientX;
                mouseY = e.clientY;
            });
            
            window.addEventListener('resize', () => {
                width = canvas.width = window.innerWidth;
                height = canvas.height = window.innerHeight;
                initParticles();
            });
            
            class Particle {
                constructor() {
                    this.reset();
                }
                
                reset() {
                    this.x = Math.random() * width;
                    this.y = Math.random() * height;
                    this.size = particleBaseRadius + Math.random() * particleVariance;
                    this.speedX = (Math.random() - 0.5) * baseSpeed;
                    this.speedY = (Math.random() - 0.5) * baseSpeed;
                    this.opacity = 0.2 + Math.random() * 0.3;
                    this.color = `rgba(0, 113, 227, ${this.opacity})`;
                }
                
                update() {
                    // Standardowy ruch czƒÖsteczki
                    this.x += this.speedX;
                    this.y += this.speedY;
                    
                    // Reakcja na mysz
                    const dx = this.x - mouseX;
                    const dy = this.y - mouseY;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < mouseMoveRadius) {
                        const force = (mouseMoveRadius - distance) / mouseMoveRadius;
                        const angle = Math.atan2(dy, dx);
                        this.x += Math.cos(angle) * force * mouseMoveForce;
                        this.y += Math.sin(angle) * force * mouseMoveForce;
                    }
                    
                    // Granice ekranu
                    if (this.x < 0 || this.x > width || this.y < 0 || this.y > height) {
                        this.reset();
                    }
                }
                
                draw() {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fillStyle = this.color;
                    ctx.fill();
                }
            }
            
            function initParticles() {
                particles = [];
                for (let i = 0; i < particleCount; i++) {
                    particles.push(new Particle());
                }
            }
            
            function connectParticles() {
                const connectionRadius = 100;
                
                for (let i = 0; i < particles.length; i++) {
                    for (let j = i + 1; j < particles.length; j++) {
                        const dx = particles[i].x - particles[j].x;
                        const dy = particles[i].y - particles[j].y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < connectionRadius) {
                            const opacity = 1 - (distance / connectionRadius);
                            ctx.beginPath();
                            ctx.moveTo(particles[i].x, particles[i].y);
                            ctx.lineTo(particles[j].x, particles[j].y);
                            ctx.strokeStyle = `rgba(0, 113, 227, ${opacity * 0.15})`;
                            ctx.lineWidth = 1;
                            ctx.stroke();
                        }
                    }
                }
            }
            
            function animate() {
                ctx.clearRect(0, 0, width, height);
                
                particles.forEach(p => {
                    p.update();
                    p.draw();
                });
                
                connectParticles();
                requestAnimationFrame(animate);
            }
            
            initParticles();
            animate();
        })();
        
        // Animacja transferu plik√≥w
        class ParticleTransfer {
            constructor() {
                this.container = document.getElementById('particles-container');
                this.active = false;
                this.particles = [];
                this.fromElement = null;
                this.toElement = null;
                this.particleCount = 30;
                this.duration = 1500;
            }
            
            startTransfer(fromElement, toElement) {
                this.active = true;
                this.fromElement = fromElement;
                this.toElement = toElement;
                this.createParticles();
                this.animate();
            }
            
            createParticles() {
                // Wyczy≈õƒá istniejƒÖce czƒÖsteczki
                this.container.innerHTML = '';
                this.particles = [];
                
                const fromRect = this.fromElement.getBoundingClientRect();
                const toRect = this.toElement.getBoundingClientRect();
                
                // PoczƒÖtkowa pozycja
                const startX = fromRect.left + fromRect.width / 2;
                const startY = fromRect.top + fromRect.height / 2;
                
                // Ko≈Ñcowa pozycja
                const endX = toRect.left + toRect.width / 2;
                const endY = toRect.top + toRect.height / 2;
                
                for (let i = 0; i < this.particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    
                    // Losowe w≈Ça≈õciwo≈õci
                    const size = Math.random() * 6 + 2;
                    const speedFactor = Math.random() * 0.4 + 0.8;
                    const delay = Math.random() * 400;
                    
                    particle.style.width = `${size}px`;
                    particle.style.height = `${size}px`;
                    particle.style.left = `${startX}px`;
                    particle.style.top = `${startY}px`;
                    particle.style.opacity = '0';
                    
                    this.container.appendChild(particle);
                    
                    this.particles.push({
                        element: particle,
                        startX,
                        startY,
                        endX,
                        endY,
                        delay,
                        speedFactor,
                        progress: 0
                    });
                }
            }
            
            animate() {
                if (!this.active) return;
                
                let allComplete = true;
                
                this.particles.forEach(particle => {
                    if (particle.progress < 1) {
                        allComplete = false;
                        
                        if (particle.delay > 0) {
                            particle.delay -= 16.7; // Przybli≈ºony interwa≈Ç requestAnimationFrame
                            return;
                        }
                        
                        particle.progress += 0.01 * particle.speedFactor;
                        if (particle.progress > 1) particle.progress = 1;
                        
                        // Funkcja ≈Çagodzenia dla bardziej naturalnego ruchu
                        const easeOutQuad = t => t * (2 - t);
                        const easedProgress = easeOutQuad(particle.progress);
                        
                        // Obliczenie pozycji na krzywej
                        const x = particle.startX + (particle.endX - particle.startX) * easedProgress;
                        const y = particle.startY + (particle.endY - particle.startY) * easedProgress;
                        
                        // Dodaj ≈Çuk do ≈õcie≈ºki
                        const curveHeight = 100;
                        const arc = Math.sin(particle.progress * Math.PI) * curveHeight;
                        const arcX = (particle.endX - particle.startX) * 0.3;
                        const arcY = -arc;
                        
                        // Zastosuj pozycjƒô do czƒÖsteczki
                        particle.element.style.left = `${x + arcX * (Math.random() - 0.5)}px`;
                        particle.element.style.top = `${y + arcY}px`;
                        
                        // Animacja przezroczysto≈õci
                        if (particle.progress < 0.1) {
                            particle.element.style.opacity = (particle.progress / 0.1).toString();
                        } else if (particle.progress > 0.9) {
                            particle.element.style.opacity = (1 - (particle.progress - 0.9) / 0.1).toString();
                        } else {
                            particle.element.style.opacity = '1';
                        }
                    }
                });
                
                if (allComplete) {
                    setTimeout(() => {
                        this.container.innerHTML = '';
                        this.active = false;
                    }, 100);
                } else {
                    requestAnimationFrame(() => this.animate());
                }
            }
        }
        
        // System powiadomie≈Ñ
        const toastContainer = document.getElementById('toast-container');
        
        function showToast(title, message, type = 'info', duration = 3000) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            
            let iconType = 'üìå';
            if (type === 'success') iconType = '‚úÖ';
            if (type === 'error') iconType = '‚ùå';
            if (type === 'warning') iconType = '‚ö†Ô∏è';
            
            toast.innerHTML = `
                <div class="toast-icon">${iconType}</div>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            // Pokazanie z animacjƒÖ
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            // Usuniƒôcie po czasie
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    toastContainer.removeChild(toast);
                }, 500);
            }, duration);
        }
        
        // ======= Inicjalizacja aplikacji =======
        document.addEventListener('DOMContentLoaded', async () => {
            const connectionStatus = document.getElementById('connection-status');
            const selfDeviceName = document.getElementById('self-device-name');
            const fileInput = document.getElementById('file-input');
            const uploadBtn = document.getElementById('upload-btn');
            const deviceContainer = document.getElementById('devices-container');
            const transferContainer = document.getElementById('transfer-container');
            const progressBar = document.getElementById('progress-bar');
            const transferPercentage = document.getElementById('transfer-percentage');
            const transferSpeed = document.getElementById('transfer-speed');
            const transferFilename = document.getElementById('transfer-filename');
            const transferTitle = document.getElementById('transfer-title');
            const transferDirectionIcon = document.getElementById('transfer-direction-icon');
            const cancelTransfer = document.getElementById('cancel-transfer');
            
            const receivedFilesContainer = document.getElementById('received-files-container');
            const filesGrid = document.getElementById('files-grid');
            const clearFilesBtn = document.getElementById('clear-files-btn');
            
            // Obs≈Çuga przycisku czyszczenia odebranych plik√≥w
            clearFilesBtn.addEventListener('click', () => {
                filesGrid.innerHTML = '';
                receivedFilesContainer.style.display = 'none';
                showToast('Pliki usuniƒôte', 'Usuniƒôto wszystkie odebrane pliki', 'info');
            });
            
            // Inicjalizacja klienta SendIt
            const client = new SendItClient();
            const particleTransfer = new ParticleTransfer();
            
            // Elementy UI dla ≈ºƒÖda≈Ñ transferu
            const transferRequestContainer = document.getElementById('transfer-request-container');
            const transferRequestSender = document.getElementById('transfer-request-sender');
            const transferFileCount = document.getElementById('transfer-file-count');
            const transferTotalSize = document.getElementById('transfer-total-size');
            const transferFileList = document.getElementById('transfer-file-list');
            const acceptTransferBtn = document.getElementById('accept-transfer');
            const rejectTransferBtn = document.getElementById('reject-transfer');
            
            // Zmienna do przechowywania bie≈ºƒÖcego ≈ºƒÖdania transferu
            let currentTransferRequest = null;
            
            // Obs≈Çuga ≈ºƒÖda≈Ñ transferu plik√≥w
            client.onTransferRequest = (peerId, request) => {
                // Zapisz bie≈ºƒÖce ≈ºƒÖdanie transferu
                currentTransferRequest = { peerId, request };
                
                // Wype≈Çnij dialog informacjami o transferze
                transferRequestSender.textContent = `Od: ${request.senderName}`;
                transferFileCount.textContent = request.files.length;
                transferTotalSize.textContent = formatFileSize(request.totalSize);
                
                // Wype≈Çnij listƒô plik√≥w
                transferFileList.innerHTML = '';
                request.files.forEach(file => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'transfer-file-item';
                    fileItem.innerHTML = `
                        <span>${file.name}</span>
                        <span>${formatFileSize(file.size)}</span>
                    `;
                    transferFileList.appendChild(fileItem);
                });
                
                // Poka≈º dialog ≈ºƒÖdania transferu
                transferRequestContainer.classList.add('active');
            };
            
            // Obs≈Çuga przycisku akceptacji transferu
            acceptTransferBtn.addEventListener('click', () => {
                if (currentTransferRequest) {
                    const { peerId } = currentTransferRequest;
                    
                    // Ukryj dialog
                    transferRequestContainer.classList.remove('active');
                    
                    // Wy≈õlij akceptacjƒô
                    client.respondToTransferRequest(peerId, true);
                    
                    // Poka≈º toast informacyjny
                    showToast('Transfer zaakceptowany', 'Rozpoczynanie odbierania plik√≥w...', 'info');
                    
                    // Wyczy≈õƒá bie≈ºƒÖce ≈ºƒÖdanie
                    currentTransferRequest = null;
                }
            });
            
            // Obs≈Çuga przycisku odrzucenia transferu
            rejectTransferBtn.addEventListener('click', () => {
                if (currentTransferRequest) {
                    const { peerId } = currentTransferRequest;
                    
                    // Ukryj dialog
                    transferRequestContainer.classList.remove('active');
                    
                    // Wy≈õlij odrzucenie
                    client.respondToTransferRequest(peerId, false);
                    
                    // Poka≈º toast informacyjny
                    showToast('Transfer odrzucony', 'Odrzucono przesy≈Çanie plik√≥w', 'warning');
                    
                    // Wyczy≈õƒá bie≈ºƒÖce ≈ºƒÖdanie
                    currentTransferRequest = null;
                }
            });
            
            // Obs≈Çuga przycisku wyboru plik√≥w
            uploadBtn.addEventListener('click', () => {
                fileInput.click();
            });
            
            // Generowanie nazwy urzƒÖdzenia
            function generateDeviceName() {
                const deviceType = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)
                    ? 'Telefon'
                    : 'Komputer';
                
                const randomId = Math.floor(Math.random() * 9000) + 1000;
                return `${deviceType} ${randomId}`;
            }
            
            // Pr√≥ba odczytania nazwy urzƒÖdzenia z localStorage lub generowanie nowej
            let deviceName = localStorage.getItem('sendit-device-name');
            if (!deviceName) {
                deviceName = generateDeviceName();
                localStorage.setItem('sendit-device-name', deviceName);
            }
            
            selfDeviceName.textContent = deviceName;
            
            // Inicjalizacja klienta WebRTC
            try {
                connectionStatus.textContent = '≈ÅƒÖczenie...';
                
                await client.init();
                client.registerDevice(deviceName);
                
                connectionStatus.textContent = 'Po≈ÇƒÖczono z sieciƒÖ';
                showToast('Po≈ÇƒÖczono', 'Po≈ÇƒÖczono z sieciƒÖ SendIt', 'success');
                
                // Obs≈Çuga aktualizacji listy urzƒÖdze≈Ñ
                client.onPeersUpdated = (peers) => {
                    // Usu≈Ñ obecne urzƒÖdzenia (poza w≈Çasnym)
                    Array.from(deviceContainer.children).forEach(child => {
                        if (!child.classList.contains('self-device')) {
                            deviceContainer.removeChild(child);
                        }
                    });
                    
                    // Dodaj wszystkie aktywne urzƒÖdzenia
                    peers.forEach(peer => {
                        const deviceElement = document.createElement('div');
                        deviceElement.className = 'other-device';
                        deviceElement.dataset.peerId = peer.id;
                        deviceElement.innerHTML = `
                            <div class="device-icon">üíª</div>
                            <div class="device-name">${peer.name}</div>
                            <div class="device-status">Dostƒôpny</div>
                        `;
                        
                        deviceContainer.appendChild(deviceElement);
                        
                        // Animacja pojawienia siƒô
                        setTimeout(() => {
                            deviceElement.classList.add('visible');
                        }, 100);
                        
                        // Obs≈Çuga klikniƒôcia na urzƒÖdzenie
                        deviceElement.addEventListener('click', () => {
                            // Je≈õli pliki zosta≈Çy wybrane, rozpocznij transfer
                            if (fileInput.files.length > 0) {
                                // Symulacja animacji transferu
                                const selfDevice = document.querySelector('.self-device');
                                particleTransfer.startTransfer(selfDevice, deviceElement);
                                
                                sendFilesToPeer(peer.id, peer.name);
                            } else {
                                showToast('Wybierz pliki', 'Najpierw wybierz pliki do udostƒôpnienia', 'warning');
                            }
                        });
                    });
                };
                
                // Obs≈Çuga nowo po≈ÇƒÖczonego urzƒÖdzenia
                client.onPeerConnected = (peer) => {
                    showToast('Nowe urzƒÖdzenie', `Wykryto: ${peer.name}`, 'info');
                };
                
                // Obs≈Çuga urzƒÖdzenia, kt√≥re siƒô roz≈ÇƒÖczy≈Ço
                client.onPeerDisconnected = (peer) => {
                    showToast('UrzƒÖdzenie od≈ÇƒÖczone', `${peer.name} opu≈õci≈Ç sieƒá`, 'warning');
                };
                
                // Obs≈Çuga postƒôpu transferu
                client.onTransferProgress = (peerId, file, progress, transferred, isReceiving = false, bytesPerSecond = 0) => {
                    const peerElement = document.querySelector(`[data-peer-id="${peerId}"]`);
                    
                    if (!transferContainer.classList.contains('active')) {
                        // Poka≈º panel transferu
                        transferContainer.classList.add('active');
                        transferFilename.textContent = file.name;
                        
                        if (isReceiving) {
                            transferTitle.textContent = `Odbieranie od: ${peerElement ? peerElement.querySelector('.device-name').textContent : 'Innego urzƒÖdzenia'}`;
                            transferDirectionIcon.textContent = 'üì•';
                        } else {
                            transferTitle.textContent = `Wysy≈Çanie do: ${peerElement ? peerElement.querySelector('.device-name').textContent : 'Innego urzƒÖdzenia'}`;
                            transferDirectionIcon.textContent = 'üì§';
                        }
                    }
                    
                    // Aktualizacja wska≈∫nika postƒôpu
                    progressBar.style.width = `${progress}%`;
                    transferPercentage.textContent = `${Math.round(progress)}%`;
                    
                    // Wy≈õwietlenie prƒôdko≈õci transferu
                    if (bytesPerSecond > 0) {
                        transferSpeed.textContent = `${formatFileSize(bytesPerSecond)}/s`;
                    } else {
                        // Obliczenie prƒôdko≈õci (przybli≈ºone)
                        if (file.size && transferred) {
                            const speed = transferred / 1024 / 1024; // MB
                            transferSpeed.textContent = `${speed.toFixed(1)} MB/s`;
                        }
                    }
                };
                
                // Obs≈Çuga zako≈Ñczenia transferu
                client.onTransferComplete = (peerId, file) => {
                    setTimeout(() => {
                        transferContainer.classList.remove('active');
                        showToast('Transfer zako≈Ñczony', `Plik "${file.name}" zosta≈Ç wys≈Çany`, 'success');
                    }, 500);
                };
                
                // Obs≈Çuga b≈Çƒôd√≥w transferu
                client.onTransferError = (peerId, errorMessage) => {
                    transferContainer.classList.remove('active');
                    showToast('B≈ÇƒÖd transferu', errorMessage, 'error');
                };
                
                // Obs≈Çuga otrzymanych plik√≥w
                client.onFilesReceived = (peerId, files) => {
                    transferContainer.classList.remove('active');
                    
                    // Poka≈º kontener na odebrane pliki, je≈õli jeszcze nie jest widoczny
                    receivedFilesContainer.style.display = 'block';
                    
                    // Dodaj ka≈ºdy plik jako kafelkƒô
                    files.forEach(file => {
                        const fileElement = document.createElement('div');
                        fileElement.className = 'file-item';
                        
                        // Okre≈õl ikonƒô na podstawie typu pliku
                        let fileIcon = 'üìÑ';
                        if (file.type.startsWith('image/')) fileIcon = 'üñºÔ∏è';
                        if (file.type.startsWith('video/')) fileIcon = 'üé¨';
                        if (file.type.startsWith('audio/')) fileIcon = 'üéµ';
                        
                        // Utw√≥rz URL dla pliku
                        const fileUrl = URL.createObjectURL(file.data);
                        
                        let previewHtml = '';
                        // Dodaj podglƒÖd je≈õli to obraz
                        if (file.type.startsWith('image/')) {
                            previewHtml = `<img src="${fileUrl}" alt="${file.name}" class="file-preview">`;
                        }
                        
                        fileElement.innerHTML = `
                            ${previewHtml}
                            <div class="file-icon">${fileIcon}</div>
                            <div class="file-name">${file.name}</div>
                            <div class="file-size">${formatFileSize(file.size)}</div>
                            <div class="file-actions">
                                <button class="file-download-btn" data-url="${fileUrl}" data-filename="${file.name}">Pobierz</button>
                            </div>
                        `;
                        
                        filesGrid.appendChild(fileElement);
                        
                        // Znajd≈∫ przycisk pobierania i dodaj obs≈Çugƒô zdarzenia
                        const downloadBtn = fileElement.querySelector('.file-download-btn');
                        downloadBtn.addEventListener('click', (e) => {
                            const url = e.target.dataset.url;
                            const filename = e.target.dataset.filename;
                            
                            const a = document.createElement('a');
                            a.href = url;
                            a.download = filename;
                            a.style.display = 'none';
                            document.body.appendChild(a);
                            a.click();
                            
                            // Nie usuwamy URL, aby zachowaƒá podglƒÖd obrazu
                            document.body.removeChild(a);
                            
                            showToast('Plik pobrany', `Plik "${filename}" zosta≈Ç pobrany`, 'success');
                        });
                    });
                    
                    const peerName = document.querySelector(`[data-peer-id="${peerId}"]`)?.querySelector('.device-name')?.textContent || 'Nieznane urzƒÖdzenie';
                    showToast('Pliki odebrane', `Otrzymano ${files.length} plik√≥w od ${peerName}`, 'success');
                };
                
                // Funkcja do wysy≈Çania plik√≥w do peera
                async function sendFilesToPeer(peerId, peerName) {
                    try {
                        const files = fileInput.files;
                        if (files.length === 0) return;
                        
                        showToast('Inicjalizacja transferu', `Przygotowanie do wysy≈Çania ${files.length} plik√≥w do ${peerName}`, 'info');
                        
                        await client.sendFiles(peerId, files);
                    } catch (error) {
                        showToast('B≈ÇƒÖd', error.message, 'error');
                    }
                }
                
                // Obs≈Çuga anulowania transferu
                cancelTransfer.addEventListener('click', () => {
                    transferContainer.classList.remove('active');
                    
                    // Anuluj transfer je≈õli jest aktywny
                    if (client.currentTransfer) {
                        const peerId = client.currentTransfer.peerId;
                        client.cancelTransfer(peerId);
                        showToast('Transfer anulowany', 'Transfer plik√≥w zosta≈Ç anulowany', 'warning');
                    } else {
                        showToast('Transfer anulowany', 'Transfer plik√≥w zosta≈Ç anulowany', 'warning');
                    }
                });
                
            } catch (error) {
                connectionStatus.textContent = 'B≈ÇƒÖd po≈ÇƒÖczenia';
                showToast('B≈ÇƒÖd po≈ÇƒÖczenia', error.message, 'error');
                console.error('B≈ÇƒÖd inicjalizacji:', error);
            }
            
            // Pomocnicza funkcja do formatowania rozmiaru plik√≥w
            function formatFileSize(bytes) {
                if (bytes === undefined || bytes === null) return '0 B';
                if (bytes < 1024) return bytes + ' B';
                else if (bytes < 1048576) return (bytes / 1024).toFixed(2) + ' KB';
                else if (bytes < 1073741824) return (bytes / 1048576).toFixed(2) + ' MB';
                else return (bytes / 1073741824).toFixed(2) + ' GB';
            }
            
            // Poka≈º toast powitalny
            setTimeout(() => {
                showToast('Witaj w SendIt', 'Udostƒôpniaj pliki bezpo≈õrednio w swojej sieci WiFi', 'info');
            }, 500);
        });
    </script>
</body>
</html>
